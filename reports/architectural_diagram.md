# MLOps Pipeline Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              MLOps Pipeline Architecture                             │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────┐
│  DATA LAYER                                                                          │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────┐      ┌─────────────┐      ┌─────────────────────────────────┐     │
│   │   Kaggle    │ ──▶  │   data.py   │ ──▶  │  GCS Bucket                     │     │
│   │  (source)   │      │ (preprocess)│      │  gs://sleaff_mlops_data_bucket  │     │
│   └─────────────┘      └─────────────┘      │  ├── data/raw/                  │     │
│                                              │  ├── data/processed/            │     │
│                              ▲               │  └── models/                    │     │
│                              │               └─────────────────────────────────┘     │
│                        ┌─────┴─────┐                      ▲                          │
│                        │    DVC    │ ◀────────────────────┘                          │
│                        │ (version) │                                                 │
│                        └───────────┘                                                 │
└──────────────────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
┌──────────────────────────────────────────────────────────────────────────────────────┐
│  TRAINING LAYER                                                                      │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐   │
│   │   Hydra     │ ──▶  │  train.py   │ ──▶  │  PyTorch    │ ──▶  │   Model     │   │
│   │  (config)   │      │             │      │  Lightning  │      │  Checkpoint │   │
│   └─────────────┘      └─────────────┘      └─────────────┘      └──────┬──────┘   │
│                                                    │                     │          │
│   ┌─────────────┐      ┌─────────────┐            │                     ▼          │
│   │   W&B       │ ◀────│  Logging    │ ◀──────────┘            ┌─────────────┐     │
│   │  (metrics)  │      │  Profiler   │                         │  GCS Bucket │     │
│   └─────────────┘      └─────────────┘                         │  (models/)  │     │
│                                                                 └─────────────┘     │
│   ┌─────────────────────────────────────┐                             ▲             │
│   │  GCP Compute Engine (GPU VM)        │                             │             │
│   │  - T4 GPU                           │ ────────────────────────────┘             │
│   │  - Docker container                 │                                           │
│   └─────────────────────────────────────┘                                           │
│                                                                                      │
│   ┌─────────────┐                                                                   │
│   │ W&B Sweeps  │  (Bayesian hyperparameter optimization)                          │
│   └─────────────┘                                                                   │
└──────────────────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
┌──────────────────────────────────────────────────────────────────────────────────────┐
│  CI/CD LAYER                                                                         │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │                         GitHub Actions                                       │   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐│   │
│   │  │   Tests     │  │   Linting   │  │ Pre-commit  │  │ Integration Tests  ││   │
│   │  │ (pytest)    │  │   (ruff)    │  │   hooks     │  │ (weekly/Sunday)    ││   │
│   │  │ multi-OS    │  │             │  │             │  │                    ││   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘│   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                              │                                       │
│                                              ▼                                       │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │                         Cloud Build                                          │   │
│   │         Docker Image ──▶ GCR (gcr.io/mlops-483515/train:latest)             │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
┌──────────────────────────────────────────────────────────────────────────────────────┐
│  SERVING LAYER                                                                       │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐   │
│   │   Docker    │ ──▶  │   FastAPI   │ ──▶  │  Model      │ ──▶  │  Prediction │   │
│   │   Image     │      │   /news/    │      │  Inference  │      │  Response   │   │
│   └─────────────┘      └─────────────┘      └─────────────┘      └─────────────┘   │
│                              ▲                                                       │
│                              │                                                       │
│   ┌─────────────┐      ┌─────┴─────┐                                                │
│   │   Locust    │ ──▶  │  Load     │                                                │
│   │ (load test) │      │  Testing  │                                                │
│   └─────────────┘      └───────────┘                                                │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
┌──────────────────────────────────────────────────────────────────────────────────────┐
│  USER INTERFACE                                                                      │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │                         Gradio Frontend                                      │   │
│   │                         http://localhost:7860                                │   │
│   │  ┌─────────────────┐         ┌──────────────────────────────────────────┐  │   │
│   │  │  Title Input    │   ──▶   │           Fake News Detector             │  │   │
│   │  │  Text Input     │         │           "This is REAL NEWS"            │  │   │
│   │  └─────────────────┘         └──────────────────────────────────────────┘  │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                              │                                       │
│                                              ▼                                       │
│                                     FastAPI :8000                                    │
└──────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────┐
│  NOT YET IMPLEMENTED (Week 3)                                                        │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│   ┌─────────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐   │
│   │  Evidently  │      │  Cloud      │      │   Alerts    │      │    ONNX     │   │
│   │  (drift)    │      │  Monitoring │      │   (GCP)     │      │ (optimize)  │   │
│   └─────────────┘      └─────────────┘      └─────────────┘      └─────────────┘   │
│                                                                                      │
│   ┌─────────────┐      ┌─────────────┐                                              │
│   │ Distributed │      │  Cloud Run  │                                              │
│   │  Training   │      │ (deploy)    │                                              │
│   └─────────────┘      └─────────────┘                                              │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

## Flow Summary

1. **Data**: Kaggle → data.py → GCS Bucket (versioned with DVC)
2. **Train**: Hydra config → train.py → PyTorch Lightning → Model → GCS
3. **CI/CD**: GitHub Actions (tests, lint) → Cloud Build → GCR
4. **Serve**: Docker → FastAPI → Model inference
5. **UI**: Gradio → FastAPI → Prediction

## Tech Stack

| Layer | Tools |
|-------|-------|
| **Data** | DVC, GCS |
| **Training** | PyTorch Lightning, Hydra, W&B |
| **CI/CD** | GitHub Actions, Cloud Build, GCR |
| **Serving** | FastAPI, Docker, Locust |
| **Frontend** | Gradio |
